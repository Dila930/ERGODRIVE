<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-left">
      <div class="logo">
        <img src="assets/logo/snapedit_1758626403883-removebg-preview.png" alt="ERGODRIVE Logo" class="logo-img">
      </div>
    </div>
    <div class="header-center">
      <h1 class="welcome-title">Selamat datang kembali!</h1>
      <p class="welcome-subtitle">Berikut adalah analisis terbaru dari tes mengemudi.</p>
    </div>
    <div class="header-right">
      <div class="user-profile" (click)="openProfileModal()">
        <div class="user-avatar">
          <span class="user-initial">{{ userInfo.initial }}</span>
          <div class="online-indicator" *ngIf="userInfo.isOnline"></div>
        </div>
        <div class="user-info">
          <div class="user-name">{{ userInfo.name }}</div>
          <div class="user-status">{{ userInfo.status }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="dashboard-content">
    <!-- Dashboard Statistics -->
    <div class="stats-overview">
      <div class="stat-card">
        <div class="stat-icon">
          <ion-icon name="clipboard-outline"></ion-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ dashboardStats.totalTests }}</div>
          <div class="stat-label">Total Tes</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <ion-icon name="checkmark-circle-outline"></ion-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ dashboardStats.completedTests }}</div>
          <div class="stat-label">Tes Selesai</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <ion-icon name="trophy-outline"></ion-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ dashboardStats.averageScore }}%</div>
          <div class="stat-label">Skor Rata-rata</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <ion-icon name="flame-outline"></ion-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ dashboardStats.streakDays }}</div>
          <div class="stat-label">Hari Berturut</div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <h2 class="section-title">Grafik Performa</h2>
      <div class="charts-grid">
        <!-- Kecepatan Rata-rata Card -->
        <div class="chart-card">
          <div class="card-header">
            <h3 class="card-title">{{ chartData.kecepatanRataRata.title }}</h3>
          </div>
          <div class="card-content">
            <div class="bar-chart">
              <div class="chart-container">
                <div class="bar-item" *ngFor="let data of chartData.kecepatanRataRata.data">
                  <div class="bar-label">{{ data.label }}</div>
                  <div class="bar-wrapper">
                    <div 
                      class="bar-fill" 
                      [style.width.%]="data.percentage"
                    ></div>
                  </div>
                  <div class="bar-value">{{ data.value }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- SDLP Card -->
        <div class="chart-card">
          <div class="card-header">
            <h3 class="card-title">{{ chartData.sdlp.title }}</h3>
          </div>
          <div class="card-content">
            <div class="bar-chart">
              <div class="chart-container">
                <div class="bar-item" *ngFor="let data of chartData.sdlp.data">
                  <div class="bar-label">{{ data.label }}</div>
                  <div class="bar-wrapper">
                    <div 
                      class="bar-fill" 
                      [style.width.%]="data.percentage"
                    ></div>
                  </div>
                  <div class="bar-value">{{ data.value }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Waktu Reaksi PDT Card -->
        <div class="chart-card">
          <div class="card-header">
            <h3 class="card-title">{{ chartData.waktuReaksiPDT.title }}</h3>
          </div>
          <div class="card-content">
            <div class="bar-chart">
              <div class="chart-container">
                <div class="bar-item" *ngFor="let data of chartData.waktuReaksiPDT.data">
                  <div class="bar-label">{{ data.label }}</div>
                  <div class="bar-wrapper">
                    <div 
                      class="bar-fill" 
                      [style.width.%]="data.percentage"
                    ></div>
                  </div>
                  <div class="bar-value">{{ data.value }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- PDT Gagal Card -->
        <div class="chart-card">
          <div class="card-header">
            <h3 class="card-title">{{ chartData.pdtGagal.title }}</h3>
          </div>
          <div class="card-content">
            <div class="bar-chart">
              <div class="chart-container">
                <div class="bar-item" *ngFor="let data of chartData.pdtGagal.data">
                  <div class="bar-label">{{ data.label }}</div>
                  <div class="bar-wrapper">
                    <div 
                      class="bar-fill" 
                      [style.width.%]="data.percentage"
                    ></div>
                  </div>
                  <div class="bar-value">{{ data.value }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance Trends Section -->
    <div class="trends-section">
      <h2 class="section-title">Tren Performa Mingguan</h2>
      <div class="trend-card">
        <div class="trends-chart">
          <div class="chart-title">Performa Mengemudi</div>
          <div class="chart-subtitle">Skor rata-rata harian</div>
          <div class="grid-lines">
            <div class="grid-line" style="bottom: 0%;" data-value="0%"></div>
            <div class="grid-line" style="bottom: 25%;" data-value="25%"></div>
            <div class="grid-line" style="bottom: 50%;" data-value="50%"></div>
            <div class="grid-line" style="bottom: 75%;" data-value="75%"></div>
            <div class="grid-line" style="bottom: 100%;" data-value="100%"></div>
          </div>
          <div class="trend-bars">
            <div class="trend-bar" *ngFor="let trend of weeklyPerformanceData; let i = index">
              <div class="trend-day">{{ trend.day }}</div>
              <div class="trend-bar-wrapper">
                <div class="trend-bar-fill" [style.height.%]="trend.value"></div>
              </div>
              <div class="trend-value">{{ trend.score }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Activities Section -->
    <div class="activities-section">
      <h2 class="section-title">Aktivitas Terkini</h2>
      <div class="activities-grid">
          <div class="activity-card" *ngFor="let activity of recentActivities">
            <div class="activity-header">
              <div class="activity-icon">
                <ion-icon [name]="getActivityIcon(activity.type)"></ion-icon>
              </div>
              <div class="activity-info">
                <h4 class="activity-title">{{ activity.title }}</h4>
                <p class="activity-time">{{ activity.time }}</p>
              </div>
              <div class="activity-status" [class]="activity.status">
                {{ activity.status === 'completed' ? 'Selesai' : activity.status === 'warning' ? 'Peringatan' : 'Sukses' }}
              </div>
            </div>
          </div>
        </div>
      </div>

    <!-- Notifications Section -->
    <div class="notifications-section">
      <h2 class="section-title">Notifikasi</h2>
      <div class="notifications-grid">
          <div class="notification-card" *ngFor="let notification of notifications" [class.unread]="!notification.read">
            <div class="notification-header">
              <h4 class="notification-title">{{ notification.title }}</h4>
              <span class="notification-time">{{ notification.time }}</span>
            </div>
            <p class="notification-message">{{ notification.message }}</p>
            <div class="notification-actions">
              <button class="mark-read-btn" (click)="markNotificationAsRead(notification.id)">Tandai Dibaca</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Profile Modal -->
<div class="profile-modal" *ngIf="showProfileModal" (click)="closeProfileModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Profil Pengguna</h2>
      <button class="close-btn" (click)="closeProfileModal()">
        <ion-icon name="close-outline"></ion-icon>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="profile-avatar-section">
        <div class="avatar-upload">
          <div class="avatar-preview">
            <span class="avatar-initial">{{ userInfo.initial }}</span>
          </div>
          <button class="avatar-change-btn" (click)="changeAvatar()">
            <ion-icon name="camera-outline"></ion-icon>
            Ganti Avatar
          </button>
        </div>
      </div>
      
      <div class="profile-form">
        <div class="form-group">
          <label for="userName">Nama Lengkap</label>
          <input type="text" id="userName" [(ngModel)]="editUserInfo.name" placeholder="Masukkan nama lengkap">
        </div>
        
        <div class="form-group">
          <label for="userEmail">Email</label>
          <input type="email" id="userEmail" [(ngModel)]="editUserInfo.email" placeholder="Masukkan email">
        </div>
        
        <div class="form-group">
          <label for="userPhone">Nomor Telepon</label>
          <input type="tel" id="userPhone" [(ngModel)]="editUserInfo.phone" placeholder="Masukkan nomor telepon">
        </div>
        
        <div class="form-group">
          <label for="userStatus">Status</label>
          <select id="userStatus" [(ngModel)]="editUserInfo.status">
            <option value="Online">Online</option>
            <option value="Offline">Offline</option>
            <option value="Sibuk">Sibuk</option>
            <option value="Away">Away</option>
          </select>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn-cancel" (click)="closeProfileModal()">Batal</button>
      <button class="btn-save" (click)="saveProfile()">Simpan Perubahan</button>
    </div>
  </div>
</div>
